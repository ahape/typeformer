From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jake Bailey <5341706+jakebailey@users.noreply.github.com>
Date: Tue, 11 Oct 2022 14:18:03 -0700
Subject: [PATCH] Specify rootDir and outDir in tsconfig-base rather than in
 each tsconfig

---
 Herebyfile.mjs                         | 16 +++++++++++-----
 src/cancellationToken/tsconfig.json    |  3 ---
 src/compiler/tsconfig.json             |  1 -
 src/debug/tsconfig.json                |  3 ---
 src/deprecatedCompat/tsconfig.json     |  1 -
 src/executeCommandLine/tsconfig.json   |  1 -
 src/harness/tsconfig.json              |  1 -
 src/jsTyping/tsconfig.json             |  1 -
 src/loggedIO/tsconfig.json             |  1 -
 src/server/tsconfig.json               |  1 -
 src/services/tsconfig.json             |  1 -
 src/testRunner/tsconfig.json           |  1 -
 src/tsc/tsconfig.json                  |  1 -
 src/tsconfig-base.json                 |  3 +++
 src/tsserver/tsconfig.json             |  1 -
 src/tsserverlibrary/tsconfig.json      |  1 -
 src/typescript/tsconfig.json           |  1 -
 src/typingsInstaller/tsconfig.json     |  1 -
 src/typingsInstallerCore/tsconfig.json |  1 -
 src/watchGuard/tsconfig.json           |  3 ---
 src/webServer/tsconfig.json            |  1 -
 21 files changed, 14 insertions(+), 30 deletions(-)

diff --git a/Herebyfile.mjs b/Herebyfile.mjs
index 83f09c201f..ceace8e46f 100644
--- a/Herebyfile.mjs
+++ b/Herebyfile.mjs
@@ -474,11 +474,14 @@ export const lint = task({
 
 const esbuildCancellationToken = esbuildTask("./src/cancellationToken/cancellationToken.ts", "./built/local/cancellationToken.js");
 
-// No need for writeCJSReexport, this outputs to the right place.
 const buildCancellationToken = task({
     name: "cancellation-token",
     dependencies: [generateDiagnostics],
-    run: () => cmdLineOptions.bundle ? esbuildCancellationToken.build() : buildProject("src/cancellationToken"),
+    run: async () =>{
+        if (cmdLineOptions.bundle) return esbuildCancellationToken.build();
+        await writeCJSReexport("./built/local/cancellationToken/cancellationToken.js", "./built/local/cancellationToken.js");
+        await buildProject("src/cancellationToken");
+    },
 });
 const cleanCancellationToken = task({
     name: "clean-cancellation-token",
@@ -494,7 +497,7 @@ const buildTypingsInstaller = task({
     dependencies: [generateDiagnostics],
     run: async () => {
         if (cmdLineOptions.bundle) return esbuildTypingsInstaller.build();
-        await writeCJSReexport("./built/typingsInstaller/nodeTypingsInstaller.js", "./built/local/typingsInstaller.js");
+        await writeCJSReexport("./built/local/typingsInstaller/nodeTypingsInstaller.js", "./built/local/typingsInstaller.js");
         await buildProject("src/typingsInstaller");
     },
 });
@@ -507,11 +510,14 @@ cleanTasks.push(cleanTypingsInstaller);
 
 const esbuildWatchGuard = esbuildTask("./src/watchGuard/watchGuard.ts", "./built/local/watchGuard.js");
 
-// No need for writeCJSReexport, this outputs to the right place.
 const buildWatchGuard = task({
     name: "watch-guard",
     dependencies: [generateDiagnostics],
-    run: () => cmdLineOptions.bundle ? esbuildWatchGuard.build() : buildProject("src/watchGuard"),
+    run: async () => {
+        if (cmdLineOptions.bundle) return esbuildWatchGuard.build();
+        await writeCJSReexport("./built/local/watchGuard/watchGuard.js", "./built/local/watchGuard.js");
+        await buildProject("src/watchGuard");
+    },
 });
 const cleanWatchGuard = task({
     name: "clean-watch-guard",
diff --git a/src/cancellationToken/tsconfig.json b/src/cancellationToken/tsconfig.json
index f12034bee9..86550f8adf 100644
--- a/src/cancellationToken/tsconfig.json
+++ b/src/cancellationToken/tsconfig.json
@@ -1,9 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
-        "tsBuildInfoFile": "../../built/local/cancellationToken.tsbuildinfo",
-        "rootDir": ".",
         "module": "commonjs",
         "types": [
             "node"
diff --git a/src/compiler/tsconfig.json b/src/compiler/tsconfig.json
index 3aa3f85519..d8029c69e4 100644
--- a/src/compiler/tsconfig.json
+++ b/src/compiler/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/compiler",
         "types": ["node"]
     },
 
diff --git a/src/debug/tsconfig.json b/src/debug/tsconfig.json
index d4eb364738..be1a75e768 100644
--- a/src/debug/tsconfig.json
+++ b/src/debug/tsconfig.json
@@ -1,9 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
-        "tsBuildInfoFile": "../../built/local/debug.tsbuildinfo",
-        "rootDir": ".",
         "target": "es2019",
         "lib": ["es2019"],
     },
diff --git a/src/deprecatedCompat/tsconfig.json b/src/deprecatedCompat/tsconfig.json
index f393a95585..d66abe57d9 100644
--- a/src/deprecatedCompat/tsconfig.json
+++ b/src/deprecatedCompat/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/deprecatedCompat",
         "experimentalDecorators": true
     },
     "references": [
diff --git a/src/executeCommandLine/tsconfig.json b/src/executeCommandLine/tsconfig.json
index 21e791dfdc..39a70ef314 100644
--- a/src/executeCommandLine/tsconfig.json
+++ b/src/executeCommandLine/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/executeCommandLine"
     },
 
     "references": [
diff --git a/src/harness/tsconfig.json b/src/harness/tsconfig.json
index 718b0fded3..d66c2d3be0 100644
--- a/src/harness/tsconfig.json
+++ b/src/harness/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/harness",
         "types": [
             "node", "mocha", "chai"
         ],
diff --git a/src/jsTyping/tsconfig.json b/src/jsTyping/tsconfig.json
index 986cdfb22a..d28ea253a8 100644
--- a/src/jsTyping/tsconfig.json
+++ b/src/jsTyping/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/jsTyping",
         "types": [
             "node"
         ],
diff --git a/src/loggedIO/tsconfig.json b/src/loggedIO/tsconfig.json
index a56535d4f3..9829567db5 100644
--- a/src/loggedIO/tsconfig.json
+++ b/src/loggedIO/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/loggedIO",
         "types": [
         ],
         "lib": [
diff --git a/src/server/tsconfig.json b/src/server/tsconfig.json
index 433d3b581e..674ed67018 100644
--- a/src/server/tsconfig.json
+++ b/src/server/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/server",
         "types": [
             "node"
         ]
diff --git a/src/services/tsconfig.json b/src/services/tsconfig.json
index e360b2f340..cbd44f9549 100644
--- a/src/services/tsconfig.json
+++ b/src/services/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/services"
     },
     "references": [
         { "path": "../compiler" },
diff --git a/src/testRunner/tsconfig.json b/src/testRunner/tsconfig.json
index 1b0ddd4fc0..de98074792 100644
--- a/src/testRunner/tsconfig.json
+++ b/src/testRunner/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/testRunner",
         "types": [
             "node", "mocha", "chai"
         ],
diff --git a/src/tsc/tsconfig.json b/src/tsc/tsconfig.json
index 8937be39f1..b4e1a49585 100644
--- a/src/tsc/tsconfig.json
+++ b/src/tsc/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/tsc"
     },
     "files": [
         "tsc.ts",
diff --git a/src/tsconfig-base.json b/src/tsconfig-base.json
index c07487870f..29fd577914 100644
--- a/src/tsconfig-base.json
+++ b/src/tsconfig-base.json
@@ -1,5 +1,8 @@
 {
     "compilerOptions": {
+        "rootDir": ".",
+        "outDir": "../built/local",
+
         "pretty": true,
         "lib": ["es2015.iterable", "es2015.generator", "es5"],
         "target": "es5",
diff --git a/src/tsserver/tsconfig.json b/src/tsserver/tsconfig.json
index b702499283..c2508ba284 100644
--- a/src/tsserver/tsconfig.json
+++ b/src/tsserver/tsconfig.json
@@ -2,7 +2,6 @@
     "extends": "../tsconfig-base",
  
     "compilerOptions": {
-        "outDir": "../../built/local/tsserver",
         "types": [
             "node"
         ]
diff --git a/src/tsserverlibrary/tsconfig.json b/src/tsserverlibrary/tsconfig.json
index 5855c7d50e..a261c45cd2 100644
--- a/src/tsserverlibrary/tsconfig.json
+++ b/src/tsserverlibrary/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/tsserverlibrary"
     },
     "files": [
         "tsserverlibrary.ts",
diff --git a/src/typescript/tsconfig.json b/src/typescript/tsconfig.json
index f30722cadc..816a2a37a9 100644
--- a/src/typescript/tsconfig.json
+++ b/src/typescript/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/typescript"
     },
     "files": [
         "typescript.ts",
diff --git a/src/typingsInstaller/tsconfig.json b/src/typingsInstaller/tsconfig.json
index 88bfb976fa..e197ac5bfa 100644
--- a/src/typingsInstaller/tsconfig.json
+++ b/src/typingsInstaller/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/typingsInstaller",
         "types": [
             "node"
         ],
diff --git a/src/typingsInstallerCore/tsconfig.json b/src/typingsInstallerCore/tsconfig.json
index d823be6e92..94c333f087 100644
--- a/src/typingsInstallerCore/tsconfig.json
+++ b/src/typingsInstallerCore/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/typingsInstallerCore",
         "types": [
             "node"
         ],
diff --git a/src/watchGuard/tsconfig.json b/src/watchGuard/tsconfig.json
index 2276c1ad14..0067737ae2 100644
--- a/src/watchGuard/tsconfig.json
+++ b/src/watchGuard/tsconfig.json
@@ -1,9 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
-        "tsBuildInfoFile": "../../built/local/watchGuard.tsbuildinfo",
-        "rootDir": ".",
         "types": [
             "node"
         ],
diff --git a/src/webServer/tsconfig.json b/src/webServer/tsconfig.json
index e1c5a2a827..89b95927dd 100644
--- a/src/webServer/tsconfig.json
+++ b/src/webServer/tsconfig.json
@@ -1,7 +1,6 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/webServer",
         "types": [
             "node"
         ]
-- 
2.38.0

