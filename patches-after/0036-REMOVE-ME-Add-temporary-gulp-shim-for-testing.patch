From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jake Bailey <5341706+jakebailey@users.noreply.github.com>
Date: Tue, 11 Oct 2022 11:35:00 -0700
Subject: [PATCH] REMOVE ME: Add temporary gulp shim for testing

---
 Gulpfile.js                 |  1 +
 package.json                |  1 +
 scripts/installGulpShim.mjs | 26 ++++++++++++++++++++++++++
 3 files changed, 28 insertions(+)
 create mode 100644 Gulpfile.js
 create mode 100644 scripts/installGulpShim.mjs

diff --git a/Gulpfile.js b/Gulpfile.js
new file mode 100644
index 0000000000..6affe5db24
--- /dev/null
+++ b/Gulpfile.js
@@ -0,0 +1 @@
+throw new Error("Do not use; run hereby instead.");
diff --git a/package.json b/package.json
index 012c6289e0..d2ffdf719e 100644
--- a/package.json
+++ b/package.json
@@ -80,6 +80,7 @@
         "which": "^2.0.2"
     },
     "scripts": {
+        "prepare": "node ./scripts/installGulpShim.mjs",
         "test": "hereby runtests-parallel --light=false",
         "test:eslint-rules": "hereby run-eslint-rules-tests",
         "build": "npm run build:compiler && npm run build:tests",
diff --git a/scripts/installGulpShim.mjs b/scripts/installGulpShim.mjs
new file mode 100644
index 0000000000..ea32d0e343
--- /dev/null
+++ b/scripts/installGulpShim.mjs
@@ -0,0 +1,26 @@
+import fs from "fs";
+
+await fs.promises.mkdir("node_modules/gulp", { recursive: true });
+
+await fs.promises.writeFile("node_modules/gulp/package.json", JSON.stringify({
+    name: "gulp",
+    version: "4.0.2",
+    bin: "index.js",
+}));
+
+await fs.promises.writeFile("node_modules/gulp/index.js", `
+const cp = require("child_process");
+const path = require("path");
+const chalk = require("chalk");
+
+console.error(chalk.red("Warning: using gulp shim; please run hereby instead."));
+
+const args = [
+    ...process.execArgv,
+    path.join(__dirname, "..", "hereby", "bin", "hereby.js"),
+    ...process.argv.slice(2),
+];
+
+const { status } = cp.spawnSync(process.execPath, args, { stdio: "inherit" });
+process.exit(status ?? 1);
+`);
-- 
2.38.0

