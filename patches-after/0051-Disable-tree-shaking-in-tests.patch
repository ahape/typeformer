From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jake Bailey <5341706+jakebailey@users.noreply.github.com>
Date: Tue, 18 Oct 2022 20:22:25 -0700
Subject: [PATCH] Disable tree shaking in tests

---
 Herebyfile.mjs | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/Herebyfile.mjs b/Herebyfile.mjs
index 0c7f47b6a7..72dd08e9e1 100644
--- a/Herebyfile.mjs
+++ b/Herebyfile.mjs
@@ -176,6 +176,7 @@ async function runDtsBundler(entrypoint, output) {
  * @property {string[]} [external]
  * @property {boolean} [exportIsTsObject]
  * @property {boolean} [setDynamicImport]
+ * @property {boolean} [treeShaking]
  */
 async function runEsbuild(entrypoint, outfile, taskOptions = {}) {
     /** @type {esbuild.BuildOptions} */
@@ -189,6 +190,7 @@ async function runEsbuild(entrypoint, outfile, taskOptions = {}) {
         format: "cjs",
         sourcemap: "linked",
         sourcesContent: false,
+        treeShaking: taskOptions.treeShaking,
         external: [
             ...(taskOptions.external ?? []),
             "source-map-support",
@@ -417,6 +419,9 @@ const { main: tests } = entrypointBuildTask({
     output: testRunner,
     mainDeps: [generateLibs],
     esbuildOptions: {
+        // Ensure we never drop any dead code, which might be helpful while debugging.
+        treeShaking: false,
+        // These are directly imported via import statements and should not be bundled.
         external: [
             "chai",
             "del",
-- 
2.38.0

