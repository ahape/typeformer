From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jake Bailey <5341706+jakebailey@users.noreply.github.com>
Date: Fri, 2 Sep 2022 15:53:02 -0700
Subject: [PATCH] Get entrypoints working

---
 src/cancellationToken/tsconfig.json          | 10 ++--------
 src/compiler/tsconfig.json                   |  2 +-
 src/compiler/tsconfig.release.json           | 10 ----------
 src/debug/tsconfig.json                      |  6 ++----
 src/deprecatedCompat/tsconfig.json           |  4 ++--
 src/dynamicImportCompat/tsconfig.json        |  9 +++------
 src/executeCommandLine/tsconfig.json         |  2 +-
 src/executeCommandLine/tsconfig.release.json | 11 ----------
 src/harness/tsconfig.json                    |  2 +-
 src/jsTyping/tsconfig.json                   |  2 +-
 src/loggedIO/tsconfig.json                   |  2 +-
 src/server/tsconfig.json                     |  4 +---
 src/services/tsconfig.json                   |  2 +-
 src/testRunner/_namespaces/FourSlash.ts      |  1 -
 src/testRunner/_namespaces/Playback.ts       |  1 -
 src/testRunner/_namespaces/Utils.ts          |  1 -
 src/testRunner/_namespaces/compiler.ts       |  1 -
 src/testRunner/_namespaces/documents.ts      |  1 -
 src/testRunner/_namespaces/evaluator.ts      |  1 -
 src/testRunner/_namespaces/fakes.ts          |  1 -
 src/testRunner/_namespaces/ts.textStorage.ts |  3 ---
 src/testRunner/_namespaces/ts.ts             |  2 --
 src/testRunner/_namespaces/vfs.ts            |  1 -
 src/testRunner/_namespaces/vpath.ts          |  1 -
 src/testRunner/compilerRef.ts                |  2 --
 src/testRunner/documentsRef.ts               |  2 --
 src/testRunner/evaluatorRef.ts               |  2 --
 src/testRunner/fakesRef.ts                   |  2 --
 src/testRunner/fourslashRef.ts               |  2 --
 src/testRunner/playbackRef.ts                |  2 --
 src/testRunner/tsconfig.json                 | 18 ++---------------
 src/testRunner/utilsRef.ts                   |  2 --
 src/testRunner/vfsRef.ts                     |  2 --
 src/testRunner/vpathRef.ts                   |  2 --
 src/tsc/_namespaces/ts.ts                    |  1 -
 src/tsc/tsconfig.json                        |  4 ++--
 src/tsc/tsconfig.release.json                | 17 ----------------
 src/tsconfig-base.json                       |  1 -
 src/tsconfig-library-base.json               | 10 ----------
 src/tsconfig-noncomposite-base.json          |  9 ---------
 src/tsconfig.json                            | 20 +++++++++++++++----
 src/tsserver/nodeServer.ts                   |  3 ++-
 src/tsserver/tsconfig.json                   |  4 ++--
 src/tsserverlibrary/_namespaces/ts.server.ts |  1 -
 src/tsserverlibrary/tsconfig.json            |  4 ++--
 src/tsserverlibrary/tsserverlibrary.ts       |  6 +++++-
 src/typescript/_namespaces/ts.ts             |  6 ++++++
 src/typescript/tsconfig.json                 | 16 +++++++++++++++
 src/typescript/typescript.ts                 | 21 ++++++++++++++++++++
 src/typingsInstaller/tsconfig.json           |  5 ++---
 src/typingsInstallerCore/tsconfig.json       |  2 +-
 src/watchGuard/tsconfig.json                 |  6 ++----
 src/webServer/tsconfig.json                  |  4 +---
 53 files changed, 96 insertions(+), 160 deletions(-)
 delete mode 100644 src/compiler/tsconfig.release.json
 delete mode 100644 src/executeCommandLine/tsconfig.release.json
 delete mode 100644 src/testRunner/_namespaces/ts.textStorage.ts
 delete mode 100644 src/testRunner/compilerRef.ts
 delete mode 100644 src/testRunner/documentsRef.ts
 delete mode 100644 src/testRunner/evaluatorRef.ts
 delete mode 100644 src/testRunner/fakesRef.ts
 delete mode 100644 src/testRunner/fourslashRef.ts
 delete mode 100644 src/testRunner/playbackRef.ts
 delete mode 100644 src/testRunner/utilsRef.ts
 delete mode 100644 src/testRunner/vfsRef.ts
 delete mode 100644 src/testRunner/vpathRef.ts
 delete mode 100644 src/tsc/tsconfig.release.json
 delete mode 100644 src/tsconfig-library-base.json
 delete mode 100644 src/tsconfig-noncomposite-base.json
 create mode 100644 src/typescript/_namespaces/ts.ts
 create mode 100644 src/typescript/tsconfig.json
 create mode 100644 src/typescript/typescript.ts

diff --git a/src/cancellationToken/tsconfig.json b/src/cancellationToken/tsconfig.json
index 6d27fe45cf..76eca8f56c 100644
--- a/src/cancellationToken/tsconfig.json
+++ b/src/cancellationToken/tsconfig.json
@@ -1,13 +1,7 @@
 {
-    "extends": "../tsconfig-noncomposite-base",
+    "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local/",
-        "rootDir": ".",
-        "composite": false,
-        "declaration": false,
-        "declarationMap": false,
-        "removeComments": true,
-        "incremental": false,
+        "outDir": "../../built/local/cancellationToken",
         "module": "commonjs",
         "types": [
             "node"
diff --git a/src/compiler/tsconfig.json b/src/compiler/tsconfig.json
index df2979bb39..3aa3f85519 100644
--- a/src/compiler/tsconfig.json
+++ b/src/compiler/tsconfig.json
@@ -1,7 +1,7 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
+        "outDir": "../../built/local/compiler",
         "types": ["node"]
     },
 
diff --git a/src/compiler/tsconfig.release.json b/src/compiler/tsconfig.release.json
deleted file mode 100644
index ecbc53d780..0000000000
--- a/src/compiler/tsconfig.release.json
+++ /dev/null
@@ -1,10 +0,0 @@
-{
-    "extends": "./tsconfig.json",
-    "compilerOptions": {
-        "outDir": "../../built/local/release",
-        "removeComments": true,
-        "preserveConstEnums": false
-    },
-    "references": [
-    ]
-}
diff --git a/src/debug/tsconfig.json b/src/debug/tsconfig.json
index 45353e0557..4f9a47f5af 100644
--- a/src/debug/tsconfig.json
+++ b/src/debug/tsconfig.json
@@ -1,11 +1,9 @@
 {
-    "extends": "../tsconfig-library-base",
+    "extends": "../tsconfig-base",
     "compilerOptions": {
         "target": "es2019",
         "lib": ["es2019"],
-        "outDir": "../../built/local",
-        "declaration": false,
-        "sourceMap": true
+        "outDir": "../../built/local/debug"
     },
     "files": [
         "dbg.ts",
diff --git a/src/deprecatedCompat/tsconfig.json b/src/deprecatedCompat/tsconfig.json
index 5eecec15a0..f393a95585 100644
--- a/src/deprecatedCompat/tsconfig.json
+++ b/src/deprecatedCompat/tsconfig.json
@@ -1,7 +1,7 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
+        "outDir": "../../built/local/deprecatedCompat",
         "experimentalDecorators": true
     },
     "references": [
@@ -19,4 +19,4 @@
         "4.8/mergeDecoratorsAndModifiers.ts",
         "_namespaces/ts.ts"
     ]
-}
\ No newline at end of file
+}
diff --git a/src/dynamicImportCompat/tsconfig.json b/src/dynamicImportCompat/tsconfig.json
index 5ae4980fda..3abacb2133 100644
--- a/src/dynamicImportCompat/tsconfig.json
+++ b/src/dynamicImportCompat/tsconfig.json
@@ -1,14 +1,11 @@
 {
-    "extends": "../tsconfig-library-base",
+    "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
+        "outDir": "../../built/local/dynamicImportCompat",
         "rootDir": ".",
         "target": "esnext",
         "module": "esnext",
-        "lib": ["esnext"],
-        "declaration": false,
-        "sourceMap": true,
-        "tsBuildInfoFile": "../../built/local/dynamicImportCompat.tsbuildinfo"
+        "lib": ["esnext"]
     },
     "files": [
         "dynamicImportCompat.ts",
diff --git a/src/executeCommandLine/tsconfig.json b/src/executeCommandLine/tsconfig.json
index 88eed2c43f..21e791dfdc 100644
--- a/src/executeCommandLine/tsconfig.json
+++ b/src/executeCommandLine/tsconfig.json
@@ -1,7 +1,7 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local"
+        "outDir": "../../built/local/executeCommandLine"
     },
 
     "references": [
diff --git a/src/executeCommandLine/tsconfig.release.json b/src/executeCommandLine/tsconfig.release.json
deleted file mode 100644
index 57ae0adbf5..0000000000
--- a/src/executeCommandLine/tsconfig.release.json
+++ /dev/null
@@ -1,11 +0,0 @@
-{
-    "extends": "./tsconfig.json",
-    "compilerOptions": {
-        "outDir": "../../built/local/release",
-        "removeComments": true,
-        "preserveConstEnums": false
-    },
-    "references": [
-        { "path": "../compiler/tsconfig.release.json" }
-    ]
-}
diff --git a/src/harness/tsconfig.json b/src/harness/tsconfig.json
index 55091a17fb..718b0fded3 100644
--- a/src/harness/tsconfig.json
+++ b/src/harness/tsconfig.json
@@ -1,7 +1,7 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
+        "outDir": "../../built/local/harness",
         "types": [
             "node", "mocha", "chai"
         ],
diff --git a/src/jsTyping/tsconfig.json b/src/jsTyping/tsconfig.json
index 9d360f086a..986cdfb22a 100644
--- a/src/jsTyping/tsconfig.json
+++ b/src/jsTyping/tsconfig.json
@@ -1,7 +1,7 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
+        "outDir": "../../built/local/jsTyping",
         "types": [
             "node"
         ],
diff --git a/src/loggedIO/tsconfig.json b/src/loggedIO/tsconfig.json
index 78c7a1ae48..a56535d4f3 100644
--- a/src/loggedIO/tsconfig.json
+++ b/src/loggedIO/tsconfig.json
@@ -1,7 +1,7 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
+        "outDir": "../../built/local/loggedIO",
         "types": [
         ],
         "lib": [
diff --git a/src/server/tsconfig.json b/src/server/tsconfig.json
index 8fac9006b0..433d3b581e 100644
--- a/src/server/tsconfig.json
+++ b/src/server/tsconfig.json
@@ -1,9 +1,7 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "removeComments": false,
-        "outDir": "../../built/local",
-        "preserveConstEnums": true,
+        "outDir": "../../built/local/server",
         "types": [
             "node"
         ]
diff --git a/src/services/tsconfig.json b/src/services/tsconfig.json
index f87f896dab..f5341a81a7 100644
--- a/src/services/tsconfig.json
+++ b/src/services/tsconfig.json
@@ -1,7 +1,7 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local"
+        "outDir": "../../built/local/services"
     },
     "references": [
         { "path": "../compiler" },
diff --git a/src/testRunner/_namespaces/FourSlash.ts b/src/testRunner/_namespaces/FourSlash.ts
index b314d7d2e2..b81535c48f 100644
--- a/src/testRunner/_namespaces/FourSlash.ts
+++ b/src/testRunner/_namespaces/FourSlash.ts
@@ -1,4 +1,3 @@
 /* Generated file to emulate the FourSlash namespace. */
 
 export * from "../../harness/_namespaces/FourSlash";
-export * from "../fourslashRef";
diff --git a/src/testRunner/_namespaces/Playback.ts b/src/testRunner/_namespaces/Playback.ts
index 756f8f0e4e..90e7eae5f1 100644
--- a/src/testRunner/_namespaces/Playback.ts
+++ b/src/testRunner/_namespaces/Playback.ts
@@ -1,4 +1,3 @@
 /* Generated file to emulate the Playback namespace. */
 
 export * from "../../loggedIO/_namespaces/Playback";
-export * from "../playbackRef";
diff --git a/src/testRunner/_namespaces/Utils.ts b/src/testRunner/_namespaces/Utils.ts
index 69e9f1e29d..f7bd754263 100644
--- a/src/testRunner/_namespaces/Utils.ts
+++ b/src/testRunner/_namespaces/Utils.ts
@@ -1,4 +1,3 @@
 /* Generated file to emulate the Utils namespace. */
 
 export * from "../../harness/_namespaces/Utils";
-export * from "../utilsRef";
diff --git a/src/testRunner/_namespaces/compiler.ts b/src/testRunner/_namespaces/compiler.ts
index b0836c2749..62e194d597 100644
--- a/src/testRunner/_namespaces/compiler.ts
+++ b/src/testRunner/_namespaces/compiler.ts
@@ -1,4 +1,3 @@
 /* Generated file to emulate the compiler namespace. */
 
 export * from "../../harness/_namespaces/compiler";
-export * from "../compilerRef";
diff --git a/src/testRunner/_namespaces/documents.ts b/src/testRunner/_namespaces/documents.ts
index ceeb38f29c..bf76b1332f 100644
--- a/src/testRunner/_namespaces/documents.ts
+++ b/src/testRunner/_namespaces/documents.ts
@@ -1,4 +1,3 @@
 /* Generated file to emulate the documents namespace. */
 
 export * from "../../harness/_namespaces/documents";
-export * from "../documentsRef";
diff --git a/src/testRunner/_namespaces/evaluator.ts b/src/testRunner/_namespaces/evaluator.ts
index 26676e38c3..9710863c9b 100644
--- a/src/testRunner/_namespaces/evaluator.ts
+++ b/src/testRunner/_namespaces/evaluator.ts
@@ -1,4 +1,3 @@
 /* Generated file to emulate the evaluator namespace. */
 
 export * from "../../harness/_namespaces/evaluator";
-export * from "../evaluatorRef";
diff --git a/src/testRunner/_namespaces/fakes.ts b/src/testRunner/_namespaces/fakes.ts
index f783f8f72b..1b6c51d409 100644
--- a/src/testRunner/_namespaces/fakes.ts
+++ b/src/testRunner/_namespaces/fakes.ts
@@ -1,4 +1,3 @@
 /* Generated file to emulate the fakes namespace. */
 
 export * from "../../harness/_namespaces/fakes";
-export * from "../fakesRef";
diff --git a/src/testRunner/_namespaces/ts.textStorage.ts b/src/testRunner/_namespaces/ts.textStorage.ts
deleted file mode 100644
index 5e49478c4d..0000000000
--- a/src/testRunner/_namespaces/ts.textStorage.ts
+++ /dev/null
@@ -1,3 +0,0 @@
-/* Generated file to emulate the ts.textStorage namespace. */
-
-export {};
diff --git a/src/testRunner/_namespaces/ts.ts b/src/testRunner/_namespaces/ts.ts
index 060d53dcda..d763d9b829 100644
--- a/src/testRunner/_namespaces/ts.ts
+++ b/src/testRunner/_namespaces/ts.ts
@@ -16,8 +16,6 @@ import * as server from "./ts.server";
 export { server };
 import * as projectSystem from "./ts.projectSystem";
 export { projectSystem };
-import * as textStorage from "./ts.textStorage";
-export { textStorage };
 export * from "../unittests/helpers";
 export * from "../unittests/services/extract/helpers";
 export * from "../unittests/tsbuild/helpers";
diff --git a/src/testRunner/_namespaces/vfs.ts b/src/testRunner/_namespaces/vfs.ts
index 3a8b4f1e4a..5fe2e7d936 100644
--- a/src/testRunner/_namespaces/vfs.ts
+++ b/src/testRunner/_namespaces/vfs.ts
@@ -1,4 +1,3 @@
 /* Generated file to emulate the vfs namespace. */
 
 export * from "../../harness/_namespaces/vfs";
-export * from "../vfsRef";
diff --git a/src/testRunner/_namespaces/vpath.ts b/src/testRunner/_namespaces/vpath.ts
index 4b1fd139b3..9ae8ad3777 100644
--- a/src/testRunner/_namespaces/vpath.ts
+++ b/src/testRunner/_namespaces/vpath.ts
@@ -1,4 +1,3 @@
 /* Generated file to emulate the vpath namespace. */
 
 export * from "../../harness/_namespaces/vpath";
-export * from "../vpathRef";
diff --git a/src/testRunner/compilerRef.ts b/src/testRunner/compilerRef.ts
deleted file mode 100644
index c524071b84..0000000000
--- a/src/testRunner/compilerRef.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-// empty ref to compiler so it can be referenced by unittests
-export { };
diff --git a/src/testRunner/documentsRef.ts b/src/testRunner/documentsRef.ts
deleted file mode 100644
index e1abbfb2d9..0000000000
--- a/src/testRunner/documentsRef.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-// empty ref to documents so it can be referenced by unittests
-export { };
diff --git a/src/testRunner/evaluatorRef.ts b/src/testRunner/evaluatorRef.ts
deleted file mode 100644
index 965acc02d9..0000000000
--- a/src/testRunner/evaluatorRef.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-// empty ref to evaluator so it can be referenced by unittests
-export { };
diff --git a/src/testRunner/fakesRef.ts b/src/testRunner/fakesRef.ts
deleted file mode 100644
index ef7d690d5b..0000000000
--- a/src/testRunner/fakesRef.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-// empty ref to fakes so it can be referenced by unittests
-export { };
diff --git a/src/testRunner/fourslashRef.ts b/src/testRunner/fourslashRef.ts
deleted file mode 100644
index 7436f5ad2d..0000000000
--- a/src/testRunner/fourslashRef.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-// empty ref to FourSlash so it can be referenced by unittests
-export { };
diff --git a/src/testRunner/playbackRef.ts b/src/testRunner/playbackRef.ts
deleted file mode 100644
index 9a46d5740c..0000000000
--- a/src/testRunner/playbackRef.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-// empty ref to Playback so it can be referenced by unittests
-export { };
diff --git a/src/testRunner/tsconfig.json b/src/testRunner/tsconfig.json
index d1893ff3b1..1b0ddd4fc0 100644
--- a/src/testRunner/tsconfig.json
+++ b/src/testRunner/tsconfig.json
@@ -1,10 +1,7 @@
 {
-    "extends": "../tsconfig-noncomposite-base",
+    "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
-        "composite": false,
-        "declaration": false,
-        "declarationMap": false,
+        "outDir": "../../built/local/testRunner",
         "types": [
             "node", "mocha", "chai"
         ],
@@ -27,16 +24,6 @@
     ],
 
     "files": [
-        "compilerRef.ts",
-        "evaluatorRef.ts",
-        "fakesRef.ts",
-        "vpathRef.ts",
-        "vfsRef.ts",
-        "fourslashRef.ts",
-        "playbackRef.ts",
-        "utilsRef.ts",
-        "documentsRef.ts",
-
         "fourslashRunner.ts",
         "compilerRunner.ts",
         "projectsRunner.ts",
@@ -263,7 +250,6 @@
         "_namespaces/ts.tscWatch.ts",
         "_namespaces/ts.projectSystem.ts",
         "_namespaces/ts.server.ts",
-        "_namespaces/ts.textStorage.ts",
         "_namespaces/tests.ts"
     ]
 }
diff --git a/src/testRunner/utilsRef.ts b/src/testRunner/utilsRef.ts
deleted file mode 100644
index 02df007be1..0000000000
--- a/src/testRunner/utilsRef.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-// empty ref to Utils so it can be referenced by unittests
-export { };
diff --git a/src/testRunner/vfsRef.ts b/src/testRunner/vfsRef.ts
deleted file mode 100644
index 7a9130a0d9..0000000000
--- a/src/testRunner/vfsRef.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-// empty ref to vfs so it can be referenced by unittests
-export { };
diff --git a/src/testRunner/vpathRef.ts b/src/testRunner/vpathRef.ts
deleted file mode 100644
index 13cb846ee5..0000000000
--- a/src/testRunner/vpathRef.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-// empty ref to vpath so it can be referenced by unittests
-export { };
diff --git a/src/tsc/_namespaces/ts.ts b/src/tsc/_namespaces/ts.ts
index 8579e4a93b..8e361ae718 100644
--- a/src/tsc/_namespaces/ts.ts
+++ b/src/tsc/_namespaces/ts.ts
@@ -2,4 +2,3 @@
 
 export * from "../../compiler/_namespaces/ts";
 export * from "../../executeCommandLine/_namespaces/ts";
-export * from "../tsc";
diff --git a/src/tsc/tsconfig.json b/src/tsc/tsconfig.json
index 205112c6f8..8937be39f1 100644
--- a/src/tsc/tsconfig.json
+++ b/src/tsc/tsconfig.json
@@ -1,7 +1,7 @@
 {
-    "extends": "../tsconfig-noncomposite-base",
+    "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local"
+        "outDir": "../../built/local/tsc"
     },
     "files": [
         "tsc.ts",
diff --git a/src/tsc/tsconfig.release.json b/src/tsc/tsconfig.release.json
deleted file mode 100644
index 8ddc790faf..0000000000
--- a/src/tsc/tsconfig.release.json
+++ /dev/null
@@ -1,17 +0,0 @@
-{
-    "extends": "./tsconfig.json",
-    "compilerOptions": {
-        "outDir": "../../built/local/release",
-        "stripInternal": true,
-        "preserveConstEnums": false,
-        "declaration": false,
-        "declarationMap": false,
-        "sourceMap": false,
-        "composite": false,
-        "incremental": true
-    },
-    "references": [
-        { "path": "../compiler/tsconfig.release.json" },
-        { "path": "../executeCommandLine/tsconfig.release.json" }
-    ]
-}
diff --git a/src/tsconfig-base.json b/src/tsconfig-base.json
index 51cf414728..d3ece6a19d 100644
--- a/src/tsconfig-base.json
+++ b/src/tsconfig-base.json
@@ -4,7 +4,6 @@
         "lib": ["es2015.iterable", "es2015.generator", "es5"],
         "target": "es5",
         "moduleResolution": "node",
-        "rootDir": ".",
 
         "declaration": true,
         "declarationMap": true,
diff --git a/src/tsconfig-library-base.json b/src/tsconfig-library-base.json
deleted file mode 100644
index f4ded3f16c..0000000000
--- a/src/tsconfig-library-base.json
+++ /dev/null
@@ -1,10 +0,0 @@
-{
-    "extends": "./tsconfig-base",
-    "compilerOptions": {
-        "declarationMap": false,
-        "composite": false,
-        "incremental":  true,
-        "declaration": true,
-        "stripInternal":  true
-    }
-}
diff --git a/src/tsconfig-noncomposite-base.json b/src/tsconfig-noncomposite-base.json
deleted file mode 100644
index 879a038f5a..0000000000
--- a/src/tsconfig-noncomposite-base.json
+++ /dev/null
@@ -1,9 +0,0 @@
-{
-    "extends": "./tsconfig-base",
-    "compilerOptions": {
-        "declaration": false,
-        "declarationMap": false,
-        "composite": false,
-        "incremental": true
-    }
-}
diff --git a/src/tsconfig.json b/src/tsconfig.json
index a8ae1655e8..bb93273166 100644
--- a/src/tsconfig.json
+++ b/src/tsconfig.json
@@ -2,13 +2,25 @@
     "files": [],
     "include": [],
     "references": [
+        { "path": "./cancellationToken" },
+        { "path": "./compiler" },
+        { "path": "./debug" },
+        { "path": "./deprecatedCompat" },
+        { "path": "./dynamicImportCompat" },
+        { "path": "./executeCommandLine" },
+        { "path": "./harness" },
+        { "path": "./jsTyping" },
+        { "path": "./loggedIO" },
+        { "path": "./server" },
+        { "path": "./services" },
+        { "path": "./testRunner" },
         { "path": "./tsc" },
         { "path": "./tsserver" },
+        { "path": "./tsserverlibrary" },
+        { "path": "./typescript" },
         { "path": "./typingsInstaller" },
+        { "path": "./typingsInstallerCore" },
         { "path": "./watchGuard" },
-        { "path": "./debug" },
-        { "path": "./cancellationToken" },
-        { "path": "./dynamicImportCompat" },
-        { "path": "./testRunner" }
+        { "path": "./webServer" },
     ]
 }
diff --git a/src/tsserver/nodeServer.ts b/src/tsserver/nodeServer.ts
index 45c89194bf..de9b8a0ad6 100644
--- a/src/tsserver/nodeServer.ts
+++ b/src/tsserver/nodeServer.ts
@@ -526,7 +526,8 @@ function startNodeSession(options: StartSessionOptions, logger: Logger, cancella
                 }
             }
 
-            this.installer = childProcess.fork(combinePaths(__dirname, "typingsInstaller.js"), args, { execArgv });
+            // TODO(jakebailey): fix this for module transform
+            this.installer = childProcess.fork(combinePaths(__dirname, "..", "typingsInstaller", "nodeTypingsInstaller.js"), args, { execArgv });
             this.installer.on("message", m => this.handleMessage(m));
 
             // We have to schedule this event to the next tick
diff --git a/src/tsserver/tsconfig.json b/src/tsserver/tsconfig.json
index 3631224da5..b702499283 100644
--- a/src/tsserver/tsconfig.json
+++ b/src/tsserver/tsconfig.json
@@ -1,8 +1,8 @@
 {
-    "extends": "../tsconfig-noncomposite-base",
+    "extends": "../tsconfig-base",
  
     "compilerOptions": {
-        "outDir": "../../built/local",
+        "outDir": "../../built/local/tsserver",
         "types": [
             "node"
         ]
diff --git a/src/tsserverlibrary/_namespaces/ts.server.ts b/src/tsserverlibrary/_namespaces/ts.server.ts
index fb916b71f4..21b0d0335f 100644
--- a/src/tsserverlibrary/_namespaces/ts.server.ts
+++ b/src/tsserverlibrary/_namespaces/ts.server.ts
@@ -2,4 +2,3 @@
 
 export * from "../../jsTyping/_namespaces/ts.server";
 export * from "../../server/_namespaces/ts.server";
-export * from "../tsserverlibrary";
diff --git a/src/tsserverlibrary/tsconfig.json b/src/tsserverlibrary/tsconfig.json
index 84e469faca..5855c7d50e 100644
--- a/src/tsserverlibrary/tsconfig.json
+++ b/src/tsserverlibrary/tsconfig.json
@@ -1,7 +1,7 @@
 {
-    "extends": "../tsconfig-library-base",
+    "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local"
+        "outDir": "../../built/local/tsserverlibrary"
     },
     "files": [
         "tsserverlibrary.ts",
diff --git a/src/tsserverlibrary/tsserverlibrary.ts b/src/tsserverlibrary/tsserverlibrary.ts
index 8aa07479d7..bd73794b37 100644
--- a/src/tsserverlibrary/tsserverlibrary.ts
+++ b/src/tsserverlibrary/tsserverlibrary.ts
@@ -1 +1,5 @@
-export { };
+import * as ts from "./_namespaces/ts";
+
+// TODO(jakebailey): replace const enum with enum in d.ts
+
+export = ts;
diff --git a/src/typescript/_namespaces/ts.ts b/src/typescript/_namespaces/ts.ts
new file mode 100644
index 0000000000..e55b264380
--- /dev/null
+++ b/src/typescript/_namespaces/ts.ts
@@ -0,0 +1,6 @@
+/* Generated file to emulate the ts namespace. */
+
+export * from "../../compiler/_namespaces/ts";
+export * from "../../jsTyping/_namespaces/ts";
+export * from "../../services/_namespaces/ts";
+export * from "../../deprecatedCompat/_namespaces/ts";
diff --git a/src/typescript/tsconfig.json b/src/typescript/tsconfig.json
new file mode 100644
index 0000000000..f30722cadc
--- /dev/null
+++ b/src/typescript/tsconfig.json
@@ -0,0 +1,16 @@
+{
+    "extends": "../tsconfig-base",
+    "compilerOptions": {
+        "outDir": "../../built/local/typescript"
+    },
+    "files": [
+        "typescript.ts",
+        "_namespaces/ts.ts"
+    ],
+    "references": [
+        { "path": "../compiler" },
+        { "path": "../jsTyping" },
+        { "path": "../services" },
+        { "path": "../deprecatedCompat" }
+    ]
+}
diff --git a/src/typescript/typescript.ts b/src/typescript/typescript.ts
new file mode 100644
index 0000000000..c9862f6a73
--- /dev/null
+++ b/src/typescript/typescript.ts
@@ -0,0 +1,21 @@
+import * as ts from "./_namespaces/ts";
+import { Debug, LogLevel } from "./_namespaces/ts";
+
+// TODO(jakebailey): replace const enum with enum in d.ts
+
+// enable deprecation logging
+declare const console: any;
+if (typeof console !== "undefined") {
+    Debug.loggingHost = {
+        log(level, s) {
+            switch (level) {
+                case LogLevel.Error: return console.error(s);
+                case LogLevel.Warning: return console.warn(s);
+                case LogLevel.Info: return console.log(s);
+                case LogLevel.Verbose: return console.log(s);
+            }
+        }
+    };
+}
+
+export = ts;
diff --git a/src/typingsInstaller/tsconfig.json b/src/typingsInstaller/tsconfig.json
index ce1cd04846..88bfb976fa 100644
--- a/src/typingsInstaller/tsconfig.json
+++ b/src/typingsInstaller/tsconfig.json
@@ -1,8 +1,7 @@
 {
-    "extends": "../tsconfig-noncomposite-base",
+    "extends": "../tsconfig-base",
     "compilerOptions": {
-        "removeComments": true,
-        "outDir": "../../built/local",
+        "outDir": "../../built/local/typingsInstaller",
         "types": [
             "node"
         ],
diff --git a/src/typingsInstallerCore/tsconfig.json b/src/typingsInstallerCore/tsconfig.json
index f1001c80d4..d823be6e92 100644
--- a/src/typingsInstallerCore/tsconfig.json
+++ b/src/typingsInstallerCore/tsconfig.json
@@ -1,7 +1,7 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "outDir": "../../built/local",
+        "outDir": "../../built/local/typingsInstallerCore",
         "types": [
             "node"
         ],
diff --git a/src/watchGuard/tsconfig.json b/src/watchGuard/tsconfig.json
index 0950720474..eb1607930c 100644
--- a/src/watchGuard/tsconfig.json
+++ b/src/watchGuard/tsconfig.json
@@ -1,9 +1,7 @@
 {
-    "extends": "../tsconfig-noncomposite-base",
+    "extends": "../tsconfig-base",
     "compilerOptions": {
-        "removeComments": true,
-        "incremental":  false,
-        "outDir": "../../built/local",
+        "outDir": "../../built/local/watchGuard",
         "types": [
             "node"
         ],
diff --git a/src/webServer/tsconfig.json b/src/webServer/tsconfig.json
index 6adb452472..e1c5a2a827 100644
--- a/src/webServer/tsconfig.json
+++ b/src/webServer/tsconfig.json
@@ -1,9 +1,7 @@
 {
     "extends": "../tsconfig-base",
     "compilerOptions": {
-        "removeComments": false,
-        "outDir": "../../built/local",
-        "preserveConstEnums": true,
+        "outDir": "../../built/local/webServer",
         "types": [
             "node"
         ]
-- 
2.38.1

